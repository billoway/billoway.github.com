<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>class dump | 点滴</title>
  <meta name="author" content="billoway">
  
  <meta name="description" content="billoway">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="class dump"/>
  <meta property="og:site_name" content="点滴"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="点滴" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">点滴</a></h1>
  <h2><a href="/">写生活、记工作</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2011-09-01T05:39:00.000Z"><a href="/blog/class-dump.html">Sep 1 2011</a></time>
      
      
  
    <h1 class="title">class dump</h1>
  

    </header>
    <div class="entry">
      
        <p>class dump 是一个命令行工具，用来监测存储在 Mach-O 二进制文件理的 Objective-C 运行时信息。它为类 (class)，分类 (category) 和协议 (protocol) 生成声明信息。这些信息与 otool -ov 命令提供的信息是一样的，但表示得更像正常的 Objective-C 的声明，所以它更紧凑，更易读
<a name="more"></a></p>
<p>为什么要使用 class-dump
对于好奇的人，是一个好工具。你可以看到闭源应用程序，框架 (framework) 和软件包 (bundle) 的设计。</p>
<p><a href="http://stevenygard.com/download/"><a href="http://stevenygard.com/download/">http://stevenygard.com/download/</a></a></p>
<p><a href="http://bitbucket.org/nygard/class-dump"><a href="http://bitbucket.org/nygard/class-dump">http://bitbucket.org/nygard/class-dump</a></a></p>
<p>用法：
class-dump [options]
选项可以是</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre>-a		<span class="command">\\</span> 显示实例变量偏移
-A		<span class="command">\\</span> 显示实现地址
–arch <span class="special">&</span>lt;arch<span class="special">&</span>gt;		<span class="command">\\</span> 选择一个指定的架构，如 ppc, ppc7400, ppc64, i386, x86_64
-C <span class="special">&</span>lt;regex<span class="special">&</span>gt;		<span class="command">\\</span> 只显示同正则表达式匹配的类
-f <span class="special">&</span>lt;str<span class="special">&</span>gt;		<span class="command">\\</span> 在方法名中查找字符串
-H		<span class="command">\\</span> 在当前目录生成头文件，或者在用 -o 选项指定的目录生成
-I		<span class="command">\\</span> 对类，目录，协议 按照继承关系 (inheritance) 进行排序 (覆盖 -s 选项)
-o <span class="special">&</span>lt;dir<span class="special">&</span>gt;		<span class="command">\\</span> 为 -H 选项指定输出目录
-r		<span class="command">\\</span> 递归扩展 framework，并修复 VM 共享库
-s		<span class="command">\\</span> 按名称对 classes 和 categories 进行排序
-S		<span class="command">\\</span> 按名称对方法 (method) 进行排序
–list-arches		<span class="command">\\</span> 类出文件中的 arches, 然后退出
–sdk-root		<span class="command">\\</span> 指定 SDK root 路径（完全路径，或者 4.1, 4.0, 3.2, 10.6，10.5，3.1.3，3.1.2）
</pre></td></tr></table></figure>

<p>class-dump-x 是一个 class-dump 的修改版，在当时（2008 年) class-dump 3.1.2 不支持 Objective-C 2.0 ABI). Objective-C 2.0 ABI 删除了 OBJC 段，在 data 段引入了一些新的 section. 并且 class/obj 的布局也边了。它不生成 @property 声明，因为所有的 properties 被映射到方法了。 不创建 @property 元素，这样的源码可以与 objc 1.0 的编译器兼容
class_dump_z 是对上面两个的改进
<a href="http://networkpx.googlecode.com/files/class-dump-z"><a href="http://networkpx.googlecode.com/files/class-dump-z">http://networkpx.googlecode.com/files/class-dump-z</a></a></p>
<p>为什么需要另外一个 class-dump</p>
<p>因为 class-dump-x 对 ivar offsets 的计算也是错误的，并不支持 properties
原版的 class-dump 虽然也支持 ABI2 了，但对 ivar 的计算依然是错误的
class-dump-z 主要针对 iPhone 程序进行 dump, 不支持以下特性
64 位（除非以后 iPhone 上的内存超过 4G 了）</p>
<p>Objective-C 1.0 ABI(iPhone 用 2.0)
class-dump-z 完全用 C++ 重写，避免动态调用，不像 class-dump 和 class-dump-x 那样使用 Objective-c 写。删除不必要的调用，使得 class-dump-z 比它的前任们快 10 倍左右。并且可以在 Linux，Mac, iPhone 上运行。</p>
<p>选项</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="code"><pre><span class="literal">-</span><span class="comment">p		\\</span> <span class="comment">转换未声明的 getters 和 setters 为 properties</span> 
<span class="literal">-</span><span class="comment">h</span> <span class="comment">proto		\\</span> <span class="comment">隐藏那些已经出现在</span> <span class="comment">协议中的方法</span>
<span class="literal">-</span><span class="comment">h</span> <span class="comment">super		\\</span> <span class="comment">隐藏继承来的方法</span>
<span class="literal">-</span><span class="comment">y</span> <span class="comment">&lt;root&gt;		\\</span> <span class="comment">选择 sysroot</span>, <span class="comment">默认是最后一版的 iPhoneOS</span> <span class="comment">SDK</span> <span class="comment">或者</span> <span class="comment">/</span>
<span class="literal">-</span><span class="comment">u</span> <span class="comment">&lt;arch&gt;		\\</span> <span class="comment">选择指定的架构 (</span> <span class="comment">armv6</span>, <span class="comment">armv7 等)</span>
<span class="literal">-</span><span class="comment">a		\\</span> <span class="comment">打印 ivar</span> <span class="comment">偏移</span>
<span class="literal">-</span><span class="comment">A		\\</span> <span class="comment">打印</span> <span class="comment">实现的 VM 地址</span>
<span class="literal">-</span><span class="comment">k		\\</span> <span class="comment">显示额外的注释</span>
<span class="literal">-</span><span class="comment">k</span> <span class="literal">-</span><span class="comment">k		\\</span> <span class="comment">显示更多注释</span>
<span class="literal">-</span><span class="comment">R		\\</span> <span class="comment">显示指针声明</span> <span class="string">,</span> <span class="comment">int</span> <span class="comment">*a</span> <span class="comment">而不是</span> <span class="comment">int*</span> <span class="comment">a(因为前者更明显地表达了指针的语义)</span>
<span class="literal">-</span><span class="comment">N		\\</span> <span class="comment">保持原始结构名</span> <span class="comment">（不用</span> <span class="comment">CFArrayRef 代替</span> <span class="comment">__CFArray)</span>
<span class="literal">-</span><span class="comment">b		\\</span> <span class="comment">在</span> <span class="literal">+</span><span class="comment">/</span>- <span class="comment">号之后放一个空格</span>,  <span class="comment">也就是</span> <span class="literal">+</span> <span class="comment">(void)</span> <span class="comment">，而不是</span> <span class="literal">+</span><span class="comment">(void)</span>
<span class="literal">-</span><span class="comment">i</span>  <span class="comment">&lt;file&gt;		\\</span> <span class="comment">读取并更新签名提示文件</span>
<span class="literal">-</span><span class="comment">C</span>  <span class="comment">&lt;regex&gt;		\\</span> <span class="comment">只显示匹配的 types</span>
<span class="literal">-</span><span class="comment">f</span>  <span class="comment">&lt;regex&gt;</span> <span class="comment">	\\</span> <span class="comment">只显示匹配的 methods</span>
<span class="literal">-</span><span class="comment">g		\\</span> <span class="comment">只显示导出 classes</span>
<span class="literal">-</span><span class="comment">X</span> <span class="comment">&lt;list&gt;	\\</span> <span class="comment">忽略所有 types(除了 categories)</span>
<span class="literal">-</span><span class="comment">h</span> <span class="comment">cats		\\</span> <span class="comment">隐藏 categories</span>
<span class="literal">-</span><span class="comment">h</span> <span class="comment">dogs		\\</span> <span class="comment">隐藏协议（这哥们太幽默了，上面是 cats（分类），这里就是 dogs 了</span>
<span class="literal">-</span><span class="comment">S		\\</span> <span class="comment">将 types 按字幕顺序排序</span>
<span class="literal">-</span><span class="comment">s		\\</span> <span class="comment">将方法按字母顺序排序</span>
<span class="literal">-</span><span class="comment">z		\\</span> <span class="comment">按照字母顺序对方法排序，但将 class 方法和</span> <span class="literal">-</span><span class="comment">init</span> <span class="comment">放在最见面</span>
<span class="literal">-</span><span class="comment">H		\\</span> <span class="comment">分离头文件</span>
<span class="literal">-</span><span class="comment">o</span> <span class="comment">&lt;dir&gt;		\\</span> <span class="comment">将头文件放到这个目录，而不是当前目录
</pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
        
  <div class="addthis addthis_toolbox addthis_default_style">
    
    
    
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:billoway.tk/blog/">
  </form>
</div>

  

  

  

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 billoway
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




</body>
</html>